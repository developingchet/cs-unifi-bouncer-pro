# ============================================================================
# cs-unifi-bouncer-pro — Environment Configuration
# ============================================================================

# ╔══════════════════════════════════════╗
# ║  MINIMAL SETUP — 3 values required  ║
# ╚══════════════════════════════════════╝

UNIFI_URL=https://192.168.1.1          # Your controller IP or hostname
UNIFI_API_KEY=your-api-key-here        # Settings → Control Plane → API Keys
CROWDSEC_LAPI_KEY=your-bouncer-api-key-here  # from: cscli bouncers add unifi-bouncer

# ╔════════════════════════════════════════════════════════════════════════╗
# ║  COMMON OVERRIDES — change only if your setup differs from defaults   ║
# ╚════════════════════════════════════════════════════════════════════════╝

# Firewall mode: auto (default), legacy (UniFi < 8.x), or zone
# FIREWALL_MODE=auto

# Sites to protect — comma-separated UniFi site internal names
# UNIFI_SITES=default
# UNIFI_SITES=default,homelab,iot

# Zone pairs — only needed when FIREWALL_MODE=zone or auto detects zone mode.
# "External" and "Internal" are the default zone names in UniFi Network 8.x.
# If you renamed your zones, check Settings → Firewall → Zones for the exact names.
# ZONE_PAIRS=External->Internal
# ZONE_PAIRS=External->Internal,External->IoT,External->DMZ

# Username/password auth (use only if API key is unavailable)
# UNIFI_USERNAME=admin
# UNIFI_PASSWORD=yourpassword
# UNIFI_PASSWORD_FILE=/run/secrets/unifi_password

# Process decisions without writing to UniFi — useful for initial testing
# DRY_RUN=false

# IPs/CIDRs that should never be blocked (comma-separated)
# BLOCK_WHITELIST=10.0.0.0/8,192.168.0.0/16

# Enable or disable IPv6 firewall rules
# FIREWALL_ENABLE_IPV6=true

# Log verbosity: trace, debug, info, warn, error, fatal, panic
# LOG_LEVEL=info

# CrowdSec LAPI URL — change if not using the default Docker service name
# CROWDSEC_LAPI_URL=http://crowdsec:8080

# ╔════════════════════════════════════════════════════════════════════════╗
# ║  ADVANCED — fine-tuning; defaults work well for most deployments      ║
# ╚════════════════════════════════════════════════════════════════════════╝

# --- UniFi Controller ---
# UNIFI_API_KEY_FILE=/run/secrets/unifi_api_key
# UNIFI_VERIFY_TLS=false
# UNIFI_CA_CERT=/etc/ssl/certs/my-unifi-ca.pem
# UNIFI_HTTP_TIMEOUT=15s
# UNIFI_API_DEBUG=false

# --- Firewall ---
# FIREWALL_BLOCK_ACTION=drop
# FIREWALL_GROUP_CAPACITY=10000
# FIREWALL_GROUP_CAPACITY_V4=10000
# FIREWALL_GROUP_CAPACITY_V6=5000
# FIREWALL_BATCH_WINDOW=500ms
# FIREWALL_LOG_DROPS=false
# FIREWALL_RECONCILE_ON_START=true
# FIREWALL_RECONCILE_INTERVAL=6h

# --- Zone-Based Firewall ---
# ZONE_CONNECTION_STATES=new,invalid
# ZONE_POLICY_REORDER=true

# --- Legacy Firewall Mode (UniFi < 8.x) ---
# LEGACY_RULE_INDEX_START_V4=22000
# LEGACY_RULE_INDEX_START_V6=27000
# LEGACY_RULESET_V4=WAN_IN
# LEGACY_RULESET_V6=WANv6_IN

# --- Object Naming Templates (Go templates) ---
# Variables: .Family (v4/v6), .Index, .Site, .SrcZone, .DstZone
# GROUP_NAME_TEMPLATE=crowdsec-block-{{.Family}}-{{.Index}}
# RULE_NAME_TEMPLATE=crowdsec-drop-{{.Family}}-{{.Index}}
# POLICY_NAME_TEMPLATE=crowdsec-policy-{{.SrcZone}}-{{.DstZone}}-{{.Family}}-{{.Index}}
# OBJECT_DESCRIPTION=Managed by cs-unifi-bouncer-pro. Do not edit manually.

# --- CrowdSec LAPI ---
# CROWDSEC_LAPI_KEY_FILE=/run/secrets/crowdsec_lapi_key
# CROWDSEC_LAPI_VERIFY_TLS=true
# CROWDSEC_ORIGINS=crowdsec,lists
# CROWDSEC_POLL_INTERVAL=30s

# --- Decision Filtering ---
# BLOCK_SCENARIO_EXCLUDE=impossible-travel,test
# BLOCK_MIN_DURATION=1h

# --- Worker Pool ---
# POOL_WORKERS=4
# POOL_QUEUE_DEPTH=4096
# POOL_MAX_RETRIES=3
# POOL_RETRY_BASE=1s

# --- API Rate Gate ---
# RATELIMIT_WINDOW=1m
# RATELIMIT_MAX_CALLS=120

# --- Session Management ---
# SESSION_REAUTH_MIN_GAP=5s
# SESSION_REAUTH_TIMEOUT=10s

# --- Storage ---
# DATA_DIR=/data
# BAN_TTL=168h

# --- Observability ---
# LOG_FORMAT=json
# METRICS_ENABLED=true
# METRICS_ADDR=:9090
# HEALTH_ADDR=:8081
# JANITOR_INTERVAL=1h
